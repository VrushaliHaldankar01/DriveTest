<!-- appointment.ejs -->
<!DOCTYPE html>
<html lang="en">
  <!-- header-->
  <%- include('layout/head');-%>
  <body>
    <!-- Navigation-->
    <%- include('layout/nav');-%>
    <!-- Page Main content-->
    <section style="background-color: #f7e1e5">
      <div class="container py-5">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="container mt-5">
              <h2 class="mb-4">Appointment Page</h2>

              <form action="/appointmentdata/store" method="POST">
                <div class="form-group">
                  <label for="appointmentDate">Date:</label>
                  <input type="date" class="form-control" id="appointmentDate"
                  name="date" required onchange="this.form.submit()" <% if
                  (selectedDate !== undefined && selectedDate !== null) { %>
                  value="<%= selectedDate %>" <% } %> />
                </div>

                <% if (selectedDate !== undefined) { %>
                <div class="form-group">
                  <label for="appointmentTimes">Available Times:</label>
                  <select
                    class="form-control"
                    id="appointmentTimes"
                    name="times"
                    multiple
                    required
                  >
                    <% availableTimes.forEach(time => { %> <% if
                    (bookedTimes.includes(time)) { %>
                    <option value="<%= time %>" disabled>
                      <%= time %> (Booked)
                    </option>
                    <% } else { %>
                    <option value="<%= time %>"><%= time %></option>
                    <% } %> <% }); %>
                  </select>
                </div>
                <% } %>

                <br />

                <button type="submit" class="btn btn-primary">
                  Submit Appointment
                </button>
              </form>

              <!-- Filter form -->
              <form action="/getdriverresult" method="GET" class="mb-4">
                <label for="testTypeFilter" class="form-label"
                  >Filter by Test Result:</label
                >
                <select
                  class="form-select"
                  id="testTypeFilter"
                  name="testTypeFilter"
                >
                  <option value="Pass">Pass</option>
                  <option value="Fail">Fail</option>
                </select>
                <button type="submit" class="btn btn-primary">
                  Apply Filter
                </button>
              </form>
              <!-- List of appointments or drivers -->
              <% if (typeof drivetest !== 'undefined' && drivetest.length > 0) {
              %>

             
                  <% if (typeof drivetest !== 'undefined' && drivetest.length >
                  0) { %>

                  <table class="table p-4 mt-5">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">First Name</th>
                        <th scope="col">Last Name</th>
                        <th scope="col">Make</th>
                        <th scope="col">Model</th>
                        <th scope="col">Year</th>
                        <th scope="col">Plate Number</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% drivetest.forEach((item) => { %>
                      <tr>
                        <td><%= item.firstName %></td>
                        <td><%= item.lastName %></td>
                        <td><%= item.car_details.make %></td>
                        <td><%= item.car_details.model %></td>
                        <td><%= item.car_details.year %></td>
                        <td><%= item.car_details.plateNumber %></td>
                      </tr>
                      <% }); %>
                    </tbody>
                  </table>

                  <% } else { %>
                  <p>No data available</p>
                  <% } %>
                </tbody>
              </table>

              <% } else { %>
              <p>No data available</p>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Footer-->
    <%- include('layout/footer');-%>
    <!-- Bootstrap core JS-->
    <%- include('layout/script');-%>
  </body>
</html>
